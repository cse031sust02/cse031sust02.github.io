<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="cse031sust02, programming, code" name="keywords">
<meta content="Talha Ibne Imam" name="author">
<meta property="og:title" content="Understanding the Nginx Server Block - cse031sust02">
<meta property="og:url" content="https://cse031sust02.github.io/post/understanding-nginx-server-block/">
<meta property="og:description" content="A n00b&#39;s rambling journey into the world of programming">
<meta property="og:type" content="website" />
<title>Understanding the Nginx Server Block | cse031sust02</title>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<link rel="stylesheet" href="https://cse031sust02.github.io//css/style.css">
<link rel="shortcut icon" href="https://cse031sust02.github.io//wave.ico">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://cse031sust02.github.io/"><h1 class="title is-4">cse031sust02</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/cse031sust02" target="_blank">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://twitter.com/cse031sust02" target="_blank">
            <span class="icon">
              <i class="fa fa-twitter"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://www.linkedin.com/in/talhasust/" target="_blank">
            <span class="icon">
              <i class="fa fa-linkedin-square"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml" target="_blank">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">Understanding the Nginx Server Block</h1>
    <h2 class="subtitle is-5">September 19, 2017 by Talha Ibne Imam</h2>
    
      <div class="tags">
    
        <a class="button is-link" href="/tags/nginx">nginx</a>
    
        <a class="button is-link" href="/tags/web-server">web-server</a>
    
        <a class="button is-link" href="/tags/http">http</a>
    
</div>

    
    <div class="content">
      

<hr />

<p>We can think of Server Blocks as specifications for individual web sites. Server blocks are the NGINX equivalent of Apache&rsquo;s virtual hosts. So in order to host our websites on Nginx server, we need to understand the directives and settings that make up the server block.</p>

<p>Here is a sample server block configuration :</p>

<pre><code>server {
  listen       80;
  server_name  _;

  location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
  }

  error_page  404              /404.html;
  location = /404.html {
    root   /usr/share/nginx/html;
  }
}
</code></pre>

<p>We can see different types of directives such as <em>listen</em>, <em>root</em>, <em>server_name</em>, <em>location</em> etc. Let&rsquo;s explore those directives.</p>

<h4 id="listen">listen</h4>

<p>It specifies the IP address / port combination that this server block is designed to respond to.</p>

<p>We can specify <strong>only the port</strong> or <strong>only the address</strong> or <strong>Both</strong>. If a port is omitted, the standard port(80) is used. And if an address is omitted, the server listens on all addresses. We can also use more than one listen directive, if needed. Here are some examples.</p>

<p><em>example,</em> port is omitted :</p>

<pre><code>listen     127.0.0.1; 
# will only respond to 127.0.0.1:80
</code></pre>

<p><em>example,</em> address is omitted :</p>

<pre><code>listen     50; 
# will respond to port 50 of all addresses. i.e: 127.0.0.1:50, localhost:50 etc..
</code></pre>

<p><em>example,</em> IP address / port combination :</p>

<pre><code>listen     192.168.25.19:60; 
# will only respond to 192.168.25.19:60
</code></pre>

<h4 id="server-name">server_name</h4>

<p>Nginx also checks the <code>Host</code> header of each request. When client makes a requests, Nginx checks if there is any server block that has a server_name directive defined with that &ldquo;Host&rdquo;. If there is a match, then that server block will responds to that request.</p>

<p>It will be easy to understand with an example.</p>

<p>Let&rsquo;s create two new host in the <code>/etc/hosts</code> file :</p>

<pre><code>127.0.0.1   localhost
127.0.0.1   www.site-one.com
127.0.0.1   www.site-two.com
</code></pre>

<p>So, now both <strong>site-one</strong> and <strong>site-two</strong> points to same IP address. But we want to put one website in site-one.com and another website in site-two.com. Let&rsquo;s create two different server blocks for those two hosts :</p>

<pre><code># First Website
server {
  listen       70;
  server_name  www.site-one.com;
  
  root   /usr/share/nginx/html/site-one/;
}

# Second Website
server {
  listen       70;
  server_name  www.site-two.com;

  root   /usr/share/nginx/html/site-two/;
}
</code></pre>

<p>So now we can access the First Website with the address <code>www.site-one.com:70</code>, and the Second Website with <code>www.site-one.com:70</code>. Now, there is a Quiz. What website will open when we go to 127.0.0.1:70?</p>

<h4 id="root">root</h4>

<p>This directive specifies the directory where the website&rsquo;s contents are located. As in our last example, the root directory was <code>/usr/share/nginx/site-two</code> for the Second Website. So when user hits the URL <em><a href="http://www.site-two.com:70/mypage.html">http://www.site-two.com:70/mypage.html</a></em>, Nginx will load <code>mypage.html</code> file from that directory.</p>

<h4 id="location">location</h4>

<p>location block is used to decide how to process the request URI (after the domain name or IP address/port). e.g. :</p>

<pre><code>location / {
  # configuration for processing all URIs that do not match other location blocks.
} 

location /one {
  # configuration for processing URIs with '/one'
}

location /two {
  # configuration for processing URIs with '/two'
}
</code></pre>

<p>A location can be defined either by a prefix string or by a regular expression. The syntax is :</p>

<pre><code>location [modifier] match {
...
}
</code></pre>

<p>When there is no modifier, the match acts just as a prefix string for the incoming URL. e.g. :</p>

<pre><code>location /two {
  # configuration for processing URIs with '/two'
}
</code></pre>

<p>And when any modifier exists, the way that Nginx matches the location will change.</p>

<p>Here is what different modifiers do :</p>

<ul>
<li><p>= <em>:</em> request URI <strong>exactly</strong> matches the location given.</p></li>

<li><p>~ <em>:</em> case-sensitive regular expression match.</p></li>

<li><p>~* <em>:</em> case-insensitive regular expression match.</p></li>

<li><p>^~ <em>:</em> regular expression matching will not take place.</p></li>
</ul>

<p>How nginx performs the matching can be found on their <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location">offcial doc</a>. Here is an example for illustrate different types of modifiers :</p>

<pre><code>location = / {
    # Only matches the / query.
}

location / {
    # URI beginning with '/'
    # But the process continues searching
}

location /documents/ {
    # URI beginning with /documents/ 
    # But the process continues searching.
}

location ^~ /images/ {
    # URI beginning with /images/
    # The process stops searching
}

location ~* \.(gif|jpg|jpeg)$ {
    # Matches requests ending in gif, jpg or jpeg. 
    # URI beginning with /images/ are NOT handled here
}

</code></pre>

<p>A more detailed overview of how nginx porcesses a request can be found <a href="http://nginx.org/en/docs/http/request_processing.html">here</a></p>

    </div>
    
        <div class="nav-left">
    <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcse031sust02.github.io%2fpost%2funderstanding-nginx-server-block%2f" title="Share on Facebook" target="_blank"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://plus.google.com/share?url=https%3a%2f%2fcse031sust02.github.io%2fpost%2funderstanding-nginx-server-block%2f" title="Share on Google+" target="_blank"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fcse031sust02.github.io%2fpost%2funderstanding-nginx-server-block%2f" title="Share on LinkedIn" target="_blank"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
    <a class="nav-item" href="https://twitter.com/home?status=Understanding%20the%20Nginx%20Server%20Block - https%3a%2f%2fcse031sust02.github.io%2fpost%2funderstanding-nginx-server-block%2f" title="Tweet this" target="_blank"><span class="fa fa-twitter fa-2x"></span></a>
    <a class="nav-item" href="http://www.reddit.com/submit?url=https%3a%2f%2fcse031sust02.github.io%2fpost%2funderstanding-nginx-server-block%2f&title=Understanding%20the%20Nginx%20Server%20Block" title="Share on Reddit" target="_blank"><span class="fa fa-reddit-alien fa-2x" aria-hidden="true"></span></a>
    
    </div>
    
  </div>
</section>

<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'cse031sust02';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; 2017 cse031sust02 | <a href="https://github.com/mgjohansen/hucore.git" target="_blank">Hucore theme</a> & <a href="http://gohugo.io" target="_blank">Hugo</a> ♥</p>
  </div>
</section>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js" integrity="sha256-+bhVTaRmJ/c07eV80nU8gD2cBBF0rYkf1txqXlrbvb0=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/php.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/javascript.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-67303858-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



</body>
